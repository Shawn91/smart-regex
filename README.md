smart regex 是一个 Python 库，它的最终目标是实现大规模文本的高速正则表达式搜索。

它以 Google Code Search 项目中所使用的高速正则表达式搜索技术为基础，将 Google Code Search 项目所支持的正则表达式语法扩展到 Python 的 re 模块所支持的所有语法。

# 1. 适用场景
以下两个条件需至少满足一个，才适合使用 smart regex：
1. 大规模文本，且文本更新频率较低
2. 大量已经事先写好的正则表达式

### FAQ：
* 多大是“大规模”？

smart regex 目前只考虑了单机情况。因此上文的“大规模”指的是单机能够处理的大规模，例如数 MB 至数十 GB。

* 为什么要“更新频率较低” 

smart regex 需要对文本做倒排索引，因此频繁的文本更新意味着倒排索引的频繁更新，可能会带来性能的降低。

* 为什么以上两个条件至少要满足一个？

smart regex 需要对文本做倒排索引，如果是对少量文本使用几个临时性的正则表达式进行搜索，大部分时间实际上都用于建立倒排索引了，反倒不如直接使用 Python 的 re 模块。

# 2. 技术原理
smart regex 的技术原理来自于 [Regular Expression Matching with a Trigram Index (How Google Code Search Worked)](https://swtch.com/~rsc/regexp/regexp4.html)。

简单来说，就是给定一个正则表达式，抽取出要想匹配这个正则表达式，一个字符串至少应该包含哪些字符。

举例来说，给定正则表达式 `ab.?c`，显然要想匹配上这个正则，一个句子中必须包含 `ab` 和 `c`。因此，只要给文本事先建好倒排索引，就可以直接提取同时包含 `ab` 和 `c` 的句子，然后使用原正则表达式去该句子中搜索，看能否找到可以匹配的字符串。

原本需要在大量文本中逐句搜索匹配，现在只需要在极少量的句子中搜索匹配即可，理论上而言，至少可以获得几十倍的提速。

# 3. 面临的问题
> 算法并不完美

当前的算法并不保证所有的正则表达式语法都能提取出必须包含的关键字。对于无法提取关键字的正则表达式，将回退至使用 re 模块进行普通的逐句正则搜索匹配。

> 部分正则提取关键字很耗时

从正则表达式中提取必须包含的关键字这一步操作是一次性的，但对于十分复杂的正则表达式，特别是包含大量 `|` 符号的正则（也包括 `\d` 或 `[a-z]`等，因为 `\d` 实际上就是 `(0|1|2|3|4|5|6|7|8|9)`），这一步很耗时（可能需要数分钟乃至更久）。

其原因可能在于关键字抽取算法涉及到布尔表达式的简化，而布尔表达式简化的时间复杂度较高（我使用了第三方库 boolean.py 来实现简化）。

该问题正在计划解决。

> 尚未支持所有的 re 模块的正则语法

目前支持的正则语法包括 `?`, `*`, `+`, `.`, `|`, `()`，其他所有字符都会当成是普通的字符进行搜索。

> 尚未实现倒排索引的自动更新